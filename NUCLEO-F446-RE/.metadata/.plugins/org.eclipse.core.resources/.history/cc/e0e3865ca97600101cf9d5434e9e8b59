#include "stm32f446xx.h"
#include <stdint.h>


//enabling the clocks 

void rcc_init(void)
{
    RCC->AHB1ENR |= RCC_AHB1ENR_GPIOAEN;// ENABLING THE CLOCKS FOR APHB 1 BUSS
    RCC->APB1ENR |= RCC_APB1ENR_TIM2EN; // ENABLING THE CLOCKS FOR APB BUS
}

void gpio_init(void)
{
    GPIOA->MODER &= ~(GPIO_MODER_MODER5_Msk); // MASK FORE RESETTING THE MODER PORT
    GPIOA->MODER |= GPIO_MODER_MODER5_1; //SETTING IT FOR ALTERNATE FUNCTION MODE 

    GPIOA->AFR[0] &= ~(GPIO_AFRL_AFSEL5_Msk);
    GPIOA->AFR[0] |= GPIO_AFRL_AFSEL5_0;

}

void tim2_init(void)
{
    TIM2->PSC = 15; //setting the prescaler to 15 based on the 16mkz input frequency 

    TIM2->ARR = 999; // setting the priod that is to the auto reload register to 999 to generate a desired 1khz frequency 

    TIM2->CCR1 |= 250;

    TIM2->CCMR1 |= TIM_CCMR1_OC1M_2; // CAPTURE COMPARE MDOE REGISTER 

    TIM2->CCER |= TIM_CCER_CC1E; // ENABLING THE CAPTURE COMPARE ENABLE REIGSTER

    TIM2->CR1 |= TIM_CR1_CEN; // ENABLING THE TIMER
}

int main(void)
{
    rcc_init();

    gpio_init();

    tim2_init();
}

