#include "stm32f446xx.h"
#include "stdint.h"


void rcc_init(void)
{
    RCC->AHB1ENR |= RCC_AHB1ENR_GPIOAEN;

    RCC->APB1ENR |= RCC_APB1ENR_TIM2EN;
}

void gpio_init(void)
{
    GPIOA->MODER &= ~(GPIO_MODER_MODER5_Msk);

    GPIOA->MODER |= (1U << GPIO_MODER_MODER5_Pos); // WHY SETTING 1 IS I'M NOT GENRATING A LTERNAT FUNCTION LIEK PWM TO PAS5 I'M JUST TOGGLING LED USING TIMER INTERRUPTS.
}

void tim2_init(void)
{
    TIM2->PSC = 15999;

    TIM2->ARR = 999;

    TIM2->CNT = 0;


    TIM2->DIER |= TIM_DIER_UIE; // ENABLING THE UPDATE INTERRUPT 

    NVIC_EnableIRQ(TIM2_IRQn); // enable tim2_IRQn

    TIM2->CR1 |= TIM_CR1_CEN; // ENABLING THE TIMER.
}

void TIM2_IRQHandler(void)
{
    if (TIM2->SR & TIM_SR_UIF)
    {
        TIM2->SR &= ~(TIM_SR_UIF);
        GPIOA->ODR ^= 1U << GPIO_ODR_OD5_Pos;
    }
}

int main(void)
{
    rcc_init();
    gpio_init();
    tim2_init();

    while(1)
    {

    }
}

